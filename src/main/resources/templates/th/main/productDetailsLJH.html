<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>

    <meta charset="UTF-8">
    <title>상품상세 LJH</title>
</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

<body>
<h1>상품상세 LJH</h1>
<input type="hidden" id="productName" value="productNmae">나무나무상자</input>
<input type="hidden" id="productNo" value="2">
<form action="/basket" method="get">
    <input type="button" value="저장" onClick="saveSessionStorage();"/>
    <input type="submit" value="장바구니모양" id="basketBtn" onClick="saveSessionStorage();">
</form>
안녕
<a href="basketPop" onclick="window.open(this.href, '_blank', 'width=300px,height=300px,resizable=no,scrollbars=no,status=no,left=0px,top=0px'); return false;">팝업 </a>

<div id="output">
    <!-- 저장된 내용을 출력할 DIV 엘리먼트 -->
</div>

<script type="text/javascript">
    var i = 0;
    var arrValue = new Array();
    var alterKey = "대체키";
    var sessionCheck = sessionStorage.getItem(alterKey);
    var a;
    var k=0;

    //
    while("대체키" == sessionStorage.key(k)){
        console.log("맞음");
        k++
        console.log(k);
        break;
    }

    console.log("키 확인 : "+sessionStorage.key(k));
    if(sessionCheck == null){
    var valList = new Array();
    a=0;
    }else{
        console.log("valLIst 세션 길이 확인" + sessionCheck.length);
        valList = sessionCheck;
        a=sessionCheck.length;
    }
    console.log("sessionCheck : "+sessionCheck);
    //var arrReal = new Array();
    var len = sessionStorage.length;
    var sessionCheckLen = sessionCheck.length;
    var key;
    document.addEventListener("DOMContentLoaded", function() {
        if(window.sessionStorage) {

            // 해당 예제를 실행하기전 이전 세션의 데이터를 clear( ) 메서드를 사용해 전부 삭제한다.
            console.log("sessionStorage가 있음");
            //console.log("session : " + window.sessionStorage);
            //console.log("object : " + printSessionStorage());
            //sessionStorage.clear();
        }
        else {
            alert("세션을 사용할 수 없는 브라우저입니다.");
        }

    });

    function printSessionStorage() {
        var i=0;
        var output = "";

        console.log("len : " + len);
        // div 태그에 로컬 저장소의 내용을 출력한다.
        for (key in window.sessionStorage) {
            /*output += "<p>";
            // getItem( ) 메서드를 이용하여 key 값의 value 값을 찾는다.
            output += key + " : " + sessionStorage.getItem(key);
            output += "<br>";

            output += "<br>";
            output += "</p>";*/
            if(i<len){
                arrValue[i] = sessionStorage.getItem(key);
                //arrValue[i] = JSON.stringify(sessionStorage.getItem(key));

                i++
            }

        }
        //console.log(arrValue);
       // console.log(arrValue[0]);
        /*for (var i = 0; i < sessionStorage.length; i++) {
            var keyTest = window.sessionStorage;
            arrValue[i] = JSON.stringify(sessionStorage.getItem(keyTest));
            //    console.log(keyTest);
            //   console.log(window.sessionStorage.length);        }
            //console.log("keyTest : " + keyTest);
            //console.log("Json:"+JSON.stringify(sessionStorage.getItem(keyTest)));

        }*/
        var form = {
            value : 1,
            hoho : arrValue
        }
        console.log("form : " +form.hoho[0]);
        console.log("form : " +form.hoho[1]);
        console.log("form : " +form.hoho[2]);
        //jQuery.ajaxSettings.traditional = true;

        $.ajax({
            //console.log("hi");
            url: "basketSession",
            type : "POST",
            traditional:true,
            data : {'hoho' : arrValue}
            ,
            success: function(){
                console.log("success");
            },
            error: function(){
                alert("test err");
            }
        });
        document.getElementById("output").innerHTML = output;
    }
    function saveSessionStorage() {

        // 변수를 선언한다.
        var key = document.getElementById("productName").value;
        var value = document.getElementById("productNo").value;

        while(true){
            console.log(a+"번째");
        if(valList[a]==null){
            valList[a] = JSON.stringify(value);
            console.log("varList" + a + "번째 : " +valList[a] );
            sessionStorage.setItem(alterKey, valList);
            break;
        }
            a++;
        }

        //var key1 = document.getElementById("option2").value;
        //var value1 = document.getElementById("option1").value;
        //그 li 안에

        //setItem(key ,value) 값에 list로 저장
        var ketList = key;

        // setItem( ) 메서드를 이용하여 key를 지정하고, value값을 세션에 저장한다.
        sessionStorage.setItem(key, JSON.stringify(value));
        //console.log("@@@@@@@@@@@@@@@ valList : "+valList);


        //console.log("세션가자");
        // console.log(sessionStorage.getItem(key));
        // console.log(JSON.stringify(value));
        // console.log(value);

        // 데이터를 출력한다.asdasdasd
        printSessionStorage();

    }

</script>
</body>
</html>