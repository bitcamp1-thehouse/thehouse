<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>

    <meta charset="UTF-8">
    <title>상품상세 LJH</title>
</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

<body>
<h1>상품상세 LJH</h1>
<input type="hidden" id="productName" value="productNmae">나무나무상자</input>
<input type="hidden" id="productNo" value="ASSIBANGKYLE-100400001-736F6E">
<form action="/basket" method="get">
    <a href="basketPop" value="저장" onClick="saveSessionStorage();
    window.open(this.href, '_blank', 'width=300px,height=300px,resizable=no,scrollbars=no,status=no,left=0px,top=0px'); return false;">저장</a>
    <input type="submit" value="장바구니모양" id="basketBtn" onClick="saveSessionStorage();">
</form>
안녕
<a href="basketPop"
   onclick="window.open(this.href, '_blank', 'width=300px,height=300px,resizable=no,scrollbars=no,status=no,left=0px,top=0px'); return false;">팝업 </a>

<div id="output">
    <!-- 저장된 내용을 출력할 DIV 엘리먼트 -->
</div>

@@@@@@@@@@@@@@@@@@@@@@@@@@TEST

@@@@@@@@@@@@@@@@@@@@@@@@@DIV TEST
<div id="tabl1"></div>
<div id="tabl2"></div>


<script type="text/javascript">
    var i = 0;
    //var arrValue = new Array();
    var goSession;
    var sessionCheck = sessionStorage.getItem("ProductNameSession");
    if (sessionCheck != null) {
        var stored = JSON.parse(sessionCheck);
        console.log("stroed : " + stored + "stored[1] = " + stored[1]);
    } else {
        console.log("stored 없음");
    }
    console.log("sessionCheck : " + sessionCheck + "getItem" + sessionStorage.getItem(sessionStorage.key(1)));
    if (sessionCheck == null) {
        console.log("sessionCheck is null");
    } else {
        console.log(" 길이 : " + sessionStorage.getItem(sessionStorage.key(1)).length);
    }
    //sessionStorage.key(1)
    var a;

    //이건 인덱스로 가져와야 되는데 key 값을 어떻게 가져올까
    //console.log("키 확인 : "+ sessionStorage.key(1));
    //console.log("값 확인 : "+ sessionCheck[2]);
    //console.log("값 길이 확인 : " + sessionCheck.length);

    //세션 값의 빈자리에 저장시켜야되는데 길이가 다른값 포함된 길이로 잡힘
    //값이 있는 자리만 추출하려 했는데 함수가 없는듯

    // 세션 받아와서  값 추가한 뒤  다시 세션에 저장
    var valList;
    var getHoho;
    if (sessionCheck == null) {
        valList = new Array();
        a = 0;
    } else {
        a = stored.length;
        console.log("stored Len : " + a);
        /* valList = sessionCheck;
         a=valList.length;
         console.log("a : " + a);*/
    }
    var key;

    function saveSessionStorage() {
        console.log("saveSessionStorage 실행");
        // 변수를 선언한다.
        var key = document.getElementById("productName").value;
        var value = document.getElementById("productNo").value;
        console.log("value  :  "+value);
        if (sessionCheck == null) {
            console.log("sessionCheck is null");
            while (true) {
                console.log(a + "번째");
                if (valList[a] == null) {
                    console.log("확인 : " + valList);
                    valList[a] = value;
                    console.log("varList" + a + "번째 : " + valList[a]);
                    break;
                }
                a++;
            }
            sessionStorage.setItem("ProductNameSession", JSON.stringify(valList));
        } else {
            a=0;
            console.log("sessionCheck is  not null");
            while (true) {
                console.log("stored[a] : " + stored[a]);
                console.log("value : " + value);
                if(stored[a] == value){
                    alert("이미 저장돼있습니다");
                    break;
                }
                if (stored[a] == null) {
                    console.log("stored" + a + " is Null");
                    stored[a] = value;
                    console.log("append 한 값은 : " + stored);
                    break;
                } else {
                    console.log("stored" + a + " is Not Null");
                }
                a++;
            }
            sessionStorage.setItem("ProductNameSession", JSON.stringify(stored));
        }


        // setItem( ) 메서드를 이용하여 key를 지정하고, value값을 세션에 저장한다.
        sessionStorage.setItem(key, value);
        //console.log("@@@@@@@@@@@@@@@ valList : "+valList);
        printSessionStorage();

    }

    //고쳐야함


    document.addEventListener("DOMContentLoaded", function () {
        if (window.sessionStorage) {

            console.log("sessionStorage가 있음");
            //sessionStorage.clear();
        } else {
            alert("세션을 사용할 수 없는 브라우저입니다.");
        }

    });

    function printSessionStorage() {
        console.log("printSessionStorage 실행");
        var i = 0;
        var output = "";

        //console.log("len : " + len);
        // 값이 있는 주소만 가져오기
        for (key in window.sessionStorage) {
            output += "<p>";
            // getItem( ) 메서드를 이용하여 key 값의 value 값을 찾는다.
            output += key + " : " + sessionStorage.getItem(key);
            output += "<br>";

            output += "<br>";
            output += "</p>";
            /*if(i<len){
                arrValue[i] = sessionStorage.getItem(key);
                //arrValue[i] = JSON.stringify(sessionStorage.getItem(key));

                i++
            }*/

        }

        //console.log(arrValue);
        // console.log(arrValue[0]);
        /*for (var i = 0; i < sessionStorage.length; i++) {
            var keyTest = window.sessionStorage;
            arrValue[i] = JSON.stringify(sessionStorage.getItem(keyTest));
            //    console.log(keyTest);
            //   console.log(window.sessionStorage.length);        }
            //console.log("keyTest : " + keyTest);
            //console.log("Json:"+JSON.stringify(sessionStorage.getItem(keyTest)));

        }*/
        /*var form = {
            value : 1,
            hoho : arrValue
        }*/
        //console.log(" hoho 0: " +form.hoho[0]);
        //console.log(" hoho 1 : " +form.hoho[1]);
        //console.log("form : " +form.hoho[2]);
        //jQuery.ajaxSettings.traditional = true;
        goSession = sessionStorage.getItem("ProductNameSession")
        console.log("goSession" + goSession);
        $.ajax({ // 세션 보내기 ajax
            //console.log("hi");
            url: "basketSession",
            type: "POST",
            traditional: true,
            data: {'hoho': goSession}
            ,
            success: function (e) {
                var result = e.result
                console.log("success");
                //console.log(hoho3);
                console.log(e);
                alert("ajax완료")
                location.href = "/productDetailsLJH";
            },
            error: function () {
                alert("test err");
            }
        });
        document.getElementById("output").innerHTML = output;
    }


</script>
</body>
</html>